<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Basketball Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .button-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .button-grid button { padding: 10px 20px; font-size: 16px; }
    #details, #players, #timeInput { display: none; margin-top: 20px; }
    .cancel-btn { margin-top: 20px; background-color: #f44336; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; }
    .cancel-btn:hover { background-color: #d32f2f; }
  </style>
</head>
<body>
  <h1>Basketball Tracker</h1>
  
  <!-- Action Buttons -->
  <div class="button-grid" id="actions">
    <button onclick="selectAction('shot make')">Shot Make</button>
    <button onclick="selectAction('shot miss')">Shot Miss</button>
    <button onclick="selectAction('rebound')">Rebound</button>
    <button onclick="selectAction('block')">Block</button>
    <button onclick="selectAction('steal')">Steal</button>
    <button onclick="selectAction('turnover')">Turnover</button>
    <button onclick="selectAction('foul')">Foul</button>
    <button onclick="selectAction('sub in')">Sub In</button>
    <button onclick="selectAction('sub out')">Sub Out</button>
    <button onclick="selectAction('record game time')">Record Game Time</button>
  </div>

  <!-- Detail Selection -->
  <div id="details">
    <h3 id="detailPrompt">Select Detail</h3>
    <div class="button-grid" id="detailOptions"></div>
    <button class="cancel-btn" onclick="resetUI()">Start Over</button>
  </div>

  <!-- Player Selection -->
  <div id="players">
    <h3>Select Player</h3>
    <div class="button-grid">
      <button onclick="recordAction(1)">Player 1</button>
      <button onclick="recordAction(2)">Player 2</button>
      <button onclick="recordAction(3)">Player 3</button>
      <button onclick="recordAction(4)">Player 4</button>
      <button onclick="recordAction(5)">Player 5</button>
      <button onclick="recordAction('Team')">Team</button>
    </div>
    <button class="cancel-btn" onclick="resetUI()">Start Over</button>
  </div>

  <!-- Time Input -->
  <div id="timeInput">
    <h3>Enter Game Time</h3>
    <input type="text" id="gameTime" placeholder="MM:SS">
    <button onclick="recordGameTime()">Submit Time</button>
    <button class="cancel-btn" onclick="resetUI()">Start Over</button>
  </div>

  <!-- Print DB -->
  <button style="margin-top: 20px;" onclick="printDatabase()">Print Full Database</button>

  <script>
    let currentAction = null;
    let detail1 = null; // To hold primary detail (points, offense/defense, etc.)
    let detail2 = null; // To hold secondary detail (type of shot, turnover type, etc.)
    let db;

    // Open IndexedDB
    const request = indexedDB.open("BasketballTrackerDB", 5);
    request.onupgradeneeded = (event) => {
      db = event.target.result;
      if (!db.objectStoreNames.contains("actions")) {
        db.createObjectStore("actions", { autoIncrement: true });
      }
    };
    request.onsuccess = (event) => {
      db = event.target.result;
    };

    // Reset UI to show actions
    function resetUI() {
      currentAction = null;
      detail1 = null;
      detail2 = null;
      document.getElementById("actions").style.display = "flex";
      document.getElementById("details").style.display = "none";
      document.getElementById("players").style.display = "none";
      document.getElementById("timeInput").style.display = "none";
    }

    // Handle action selection
    function selectAction(action) {
      currentAction = action;
      detail1 = null;
      detail2 = null;
      document.getElementById("actions").style.display = "none";

      if (action.startsWith("shot")) {
        showDetailOptions("Points", ["Free Throw", "2-Pointer", "3-Pointer"]);
      } else if (action === "rebound") {
        showDetailOptions("Rebound Type", ["Offensive", "Defensive"]);
      } else if (action === "turnover") {
        showDetailOptions("Turnover Type", ["Ball Stolen", "Traveling", "Out of Bounds", "Double Dribble", "Other"]);
      } else if (action === "foul") {
        showDetailOptions("Foul Type", ["Offensive", "Defensive"]);
      } else if (action === "record game time") {
        document.getElementById("timeInput").style.display = "block";
      } else {
        document.getElementById("players").style.display = "block";
      }
    }

    // Show detail options
    function showDetailOptions(prompt, options) {
      document.getElementById("details").style.display = "block";
      document.getElementById("detailPrompt").innerText = `Select ${prompt}`;
      const detailOptions = document.getElementById("detailOptions");
      detailOptions.innerHTML = "";
      options.forEach(option => {
        const button = document.createElement("button");
        button.textContent = option;
        button.onclick = () => handleDetailSelection(option);
        detailOptions.appendChild(button);
      });
    }

    // Handle detail selection
    function handleDetailSelection(option) {
      if (!detail1) {
        detail1 = option;
        if (currentAction.startsWith("shot") && detail1 === "2-Pointer") {
          showDetailOptions("Shot Type", [
            "Lay Up", "Paint - Near", "Paint - Far",
            "Mid-Range - Left Baseline", "Mid-Range - Right Baseline",
            "Mid-Range - Left Wing", "Mid-Range - Right Wing",
            "Mid-Range - Top of the Key"
          ]);
        } else if (currentAction.startsWith("shot") && detail1 === "3-Pointer") {
          showDetailOptions("Shot Type", [
            "Three-Point - Left Corner", "Three-Point - Right Corner",
            "Three-Point - Left Wing", "Three-Point - Right Wing",
            "Three-Point - Top of the Arc"
          ]);
        } else {
          document.getElementById("details").style.display = "none";
          document.getElementById("players").style.display = "block";
        }
      } else {
        detail2 = option;
        document.getElementById("details").style.display = "none";
        document.getElementById("players").style.display = "block";
      }
    }

    // Record player action
    function recordAction(player) {
      const data = { action: currentAction, player: player, detail1: detail1, detail2: detail2, timestamp: new Date().toISOString() };
      console.log("Recorded:", data);

      const transaction = db.transaction("actions", "readwrite");
      const store = transaction.objectStore("actions");
      store.add(data);

      resetUI(); // Reset UI to main actions
    }

    // Record game time
    function recordGameTime() {
      const time = document.getElementById("gameTime").value;
      if (!time) {
        alert("Please enter a valid time!");
        return;
      }
      const data = { action: "record game time", time: time, timestamp: new Date().toISOString() };
      console.log("Recorded:", data);

      const transaction = db.transaction("actions", "readwrite");
      const store = transaction.objectStore("actions");
      store.add(data);

      resetUI(); // Reset UI to main actions
    }

    // Print full database
    function printDatabase() {
      const transaction = db.transaction("actions", "readonly");
      const store = transaction.objectStore("actions");
      const request = store.getAll();

      request.onsuccess = (event) => {
        console.log("Full Database:", event.target.result);
      };
    }

    // Initialize UI
    resetUI();
  </script>
</body>
</html>
